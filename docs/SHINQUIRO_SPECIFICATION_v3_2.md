# プロジェクト完全仕様書 - SHINQUIRO v3

**最終更新日**: 2026年2月
**バージョン**: 3.3

---

## 1. プロジェクト概要

### 基本情報
| 項目 | 内容 |
|------|------|
| 名称 | SHINQUIRO（シンキロウ） |
| 目的 | 大学受験英語長文の検索・分析システム |
| 対象ユーザー | 教師・塾講師・受験生 |
| ホスティング | Netlify |

### 技術スタック
| カテゴリ | 技術 |
|----------|------|
| フレームワーク | Next.js 16.0.8 (App Router) |
| UI | React 19.2.0, Tailwind CSS 4 |
| アイコン | Lucide React |
| CSV処理 | PapaParse |
| Markdown | react-markdown |

---

## 2. 画面構成

### 画面一覧

| # | 画面名 | パス | 主な機能 |
|---|--------|------|----------|
| 1 | トップページ | `/` | サイトのハブ。各機能への導線 |
| 2 | 長文検索 | `/search` | 長文の絞り込み検索 |
| 3 | 大問詳細ページ | `/mondai/[識別名]` | 大問の詳細情報・重要単語 |
| 4 | 大学別一覧ページ | `/university/[大学コード]` | 大学ごとの過去問一覧 |
| 5 | 単語検索・比較 | `/words` | 単語帳での掲載状況確認・大学別検索 |
| 6 | 記事一覧 | `/articles` | 記事のカテゴリ別一覧 |
| 7 | 記事詳細 | `/articles/[slug]` | 記事本文の表示 |
| 8 | 本文レベル説明 | `/about/passage-levels` | レベル基準の説明 |
| 9 | 設問形式説明 | `/about/question-formats` | 各設問形式の説明（準備中） |

### サイト構成図

```
トップページ（/）
├── 長文検索（/search）
│   ├── 大問詳細（/mondai/[id]）
│   └── 大学別一覧（/university/[code]）
├── 単語検索（/words）
├── 記事一覧（/articles）
│   └── 記事詳細（/articles/[slug]）
└── About系（/about/...）
```

---

## 3. 各画面の詳細仕様

### 3.0 トップページ (`app/page.js`)

#### 概要
サイト全体のハブとして、各機能への導線を提供するランディングページ。

#### セクション構成

1. **ヒーローセクション**
   - サイトタイトル「大学受験英語の検索・分析システム」
   - サイト説明文

2. **機能カード（3列）**
   - 長文検索（緑）: `/search` へ
   - 単語検索（青）: `/words` へ
   - 記事（紫）: `/articles` へ

3. **特徴セクション**
   - 詳細な検索条件
   - 単語帳横断検索
   - 大学別分析

#### デザイン
- 各カードはホバー時にボーダーと影が変化
- アイコンはホバー時に背景色と文字色が反転
- レスポンシブ対応（モバイルは1列、タブレット2列、PC3列）

---

### 3.1 長文検索 (`app/search/page.js`)

#### 概要
長文データを多角的に絞り込み検索できるメイン検索画面。

#### フィルター機能一覧

| フィルター名 | 入力形式 | 複数選択 | 説明 |
|-------------|----------|----------|------|
| 試験区分 | ボタン | ✅ | 国公立/私立/共通テスト/資格 |
| 大学名・試験名 | テキスト（サジェスト付き） | - | 大学名で絞り込み |
| 年度 | ドロップダウン×2 | - | 開始年〜終了年の範囲指定 |
| 本文語数 | レンジスライダー×2 | - | 0〜1500語の範囲指定 |
| 本文レベル | ボタン | ✅ | S/A/B/C/D |
| ジャンル | ボタン | - | 単一選択 |
| ハッシュタグ | モーダル検索 | ✅ | AND/OR切替可能 |
| 文章記述(日) | 3択ボタン | - | 必須/どちらでも/除外 |
| 文章記述(英) | 3択ボタン | - | 必須/どちらでも/除外 |
| 設問カテゴリ | ボタン | ✅ | 選択/文章記述(日)/文章記述(英)/短答記述 |
| 設問形式 | ボタン | ✅ | 内容一致/正誤判定/英文和訳など |
| 知識・文法 | モーダル検索 | ✅ | 関係代名詞/不定詞/倒置など |
| フリーワード | テキスト | - | 大学名/学部/ジャンル/ハッシュタグを横断検索 |

#### フィルタリングロジック（重要）
```
設問カテゴリ・設問形式・知識文法は「同一設問でAND条件」
例: 「選択」かつ「内容一致」かつ「関係代名詞」を含む設問がある大問のみ表示
```

#### ソート機能
- 年度順（新しい/古い）
- 語数順（多い/少ない）
- 本文レベル順（難しい/易しい）

#### UI要素
- **スクロール時固定バー**: 現在の検索条件を表示
- **左下固定**: ヒット数表示（緑ボーダー、点滅アニメーション）
- **50件ずつ表示**: 「さらに50件表示」ボタン

#### 検索結果カード
```
┌─────────────────────────────────────────────────────────┐
│ [試験区分] 大学名 年度 日程 方式 学部 【大問番号】 語数 設問数   │
│ [Lv.X] [ジャンル] #ハッシュタグ1 #ハッシュタグ2 ...           │
│                                                         │
│           [大問詳細を見る] [Amazon]                        │
│              ▼ 設問構成を見る                              │
└─────────────────────────────────────────────────────────┘
```

展開時: 設問構成テーブル + 3つのリンクボタン

---

### 3.2 大問詳細ページ (`app/mondai/[id]/page.js`)

#### 概要
個別の大問について詳細情報を表示。重要単語のチェック機能付き。

#### セクション構成

1. **パンくずリスト**
   ```
   検索画面 > 大学名 > 年度 日程 方式 学部 大問番号
   ```

2. **基本情報テーブル**
   - 本文語数
   - 本文レベル（説明リンク付き）
   - 設問数（文章記述内訳）
   - ジャンル
   - テーマ・キーワード（ハッシュタグ）
   - 出典
   - Amazonリンク

3. **設問構成テーブル**
   | 設問名 | 設問カテゴリ | 設問形式 | 知識・文法 |

4. **講評・ポイント**（Markdown）
   - `/public/reviews/[識別名].md` から読み込み

5. **「データの修正を依頼」リンク**
   - 設問構成ブロックと重要単語ブロックの間に右寄せで配置
   - Googleフォームへ新しいタブで遷移（フッターと同じリンク先）

6. **重要単語セクション**

#### 重要単語機能

**モード切替**: 一覧 / チェック

**レベル振り分けロジック（複数レベル対応）**:
- 同じ単語がkeywords.csvで複数レベルに存在する場合:
  - **一覧モード**: それぞれのレベルに別々に表示（そのレベルに応じた意味を表示）
  - **チェックモード**: 選択したレベルに1つでも該当すれば出題（出題は1回のみ、全レベルの意味をピンクハイライト表示）
- `filterKeywordsByLevelsUnique()`: 単語単位でユニーク化し `allLevels` プロパティを付与

**一覧モード**:
- **品詞フィルタ**: レベルタブの上に中央揃えで4つのトグルボタン（動詞/名詞/形容詞副詞/その他）。デフォルト全選択。タブのカウントと単語一覧の両方に適用
- レベル別グループ化（修練/上級/標準/基礎）
- グリッド表示（PC: 4列、タブレット: 3列、スマホ: 2列）
- ボタン式チェックボックス
- 各レベルに「すべて選択/解除」ボタン
- 機能ボタン:
  - ✓の単語をコピー
  - ✓の単語を単語帳比較へ（新しいタブ）

**チェックモード**:
1. **レベル選択画面**:
   - 品詞フィルタ（4ボタン、左側）× レベル選択（4ボタン、右側）を横並び配置、間に「×」マーク
   - 品詞デフォルト全選択、レベルデフォルト未選択
   - レベル別語数は品詞フィルタに連動
   - **「この大問で出題された意味のみをチェック」トグル**: デフォルトON、ピンク色（bg-pink-300）
     - ON: keyword由来の意味のみ隠し、それ以外の意味は最初から表示
     - OFF: 従来通りすべての意味を非表示
2. **単語チェック中**:
   - プログレスバー
   - 単語を大きく表示
   - 品詞+レベルタグ、意味表示（keyword由来はピンクハイライト）
   - 「自信なし」「自信あり」ボタン
   - ランダム順で出題
3. **結果画面**:
   - 2カラム（自信なし/自信あり）
   - 各単語の下に品詞・意味を表示
   - 複数レベルにまたがる単語は全レベルの絵文字を表示
   - チェックボックスで選択
   - コピー・単語帳比較へ連携

7. **単語帳掲載状況セクション**

#### 単語詳細モーダル
- ヘッダーに品詞・意味・レベルを表示
  - 品詞ごとにレベル名（テキスト）を左側に表示
  - keyword由来の意味はピンク太字（text-pink-400）でハイライト
- 各単語帳での掲載状況一覧

---

### 3.3 大学別一覧ページ (`app/university/[code]/page.js`)

#### 概要
特定の大学の過去問を一覧表示。行全体がクリック可能なテーブル形式。

#### URL構造
```
/university/[大学コード]
/university/[大学コード]?year=2025
/university/[大学コード]?year=2025&gakubu=文学部
```

#### 上部フィルター（ボタン式）
- 年度（複数選択、「すべて選択」付き）
- 日程（複数選択）
- 方式（複数選択）
- 学部（複数選択）

#### テーブル構成（レスポンシブ対応）

**PC（lg以上）: 8カラム**
| 年度 | 大問 | 日程 方式 学部 | ジャンル+タグ | 本文Lv | 語数 | 設問 | 文章記述 |

**スマホ（lg未満）: 5カラム**
| 年度+大問 | 日程+学部 | ジャンル+タグ | Lv+語数 | 設問+記述 |

#### 特徴
- 行全体がクリック可能（詳細ページへ遷移）
- ジャンルの下に1つ目のハッシュタグを表示
- ストライプ表示
- デフォルトソート: 年度降順

---

### 3.4 単語検索・単語帳比較 (`app/words/page.js`)

#### 概要
英単語が各単語帳に掲載されているか確認できる。3つのモードを切り替えて使用。

#### モード切替（3モード）
- **単語検索モード**: 1単語ずつ検索
- **単語帳比較モード**: 複数単語を一括比較
- **大学別検索モード**: 大学・年度で絞り込んで出題単語を検索

---

#### 3.4.1 単語検索モード

**検索機能**:
- 単語を入力してEnterで検索
- 対象単語帳を複数選択可

**検索結果ヘッダー**:
- 検索した単語を大きく表示
- word_master.csvから品詞・意味を取得して表示（優先度の昇順でソート）
- 品詞バッジはグレーに統一（bg-gray-100 text-gray-700）、意味は太字
- 横並び表示（品詞+意味のセット単位で折り返し、途中改行なし）

**検索結果テーブル（レスポンシブ対応）**:

PC（md以上）: 3カラム
| 単語帳名 | 掲載状況 | 関連語 |

スマホ（md未満）: 2カラム
| 単語帳名 / 掲載状況 | 関連語 |

- 掲載状況: ◯見出し語 / △関連語 / - 掲載なし
- 番号/ページ表示
- 左ボーダー色分け（緑: 見出し語、橙: 関連語）
- スマホでは単語帳名の下に掲載状況を縦積み表示
- **単語帳名はAmazonリンク付き**（tangocho_master.csvのASINを使用、オレンジ色の外部リンクアイコン表示）

**出現した大問セクション（レスポンシブ対応）**:
- 検索した単語が出現した大問を一覧表示
- タイトル横に注釈「該当する大問がない場合、または多すぎる場合は表示されません」
- **意味フィルタ**: keywords.csvに存在する意味をトグルボタンとして表示（複数選択可、デフォルト全選択）。選択した意味で大問をフィルタリング

PC（md以上）: 6カラム
| 大学名 | 年度 | 日程 | 学部 | 大問番号 | ジャンル+ハッシュタグ |

スマホ（md未満）: 4カラム
| 大学名 / 年度 | 日程 / 学部 | 大問番号 | ジャンル+ハッシュタグ |

- 行クリックで大問詳細ページへ遷移

**検索履歴機能**:
- 最大10件保持
- 重複排除
- 「履歴を一括比較」→ 比較モードへ

---

#### 3.4.2 単語帳比較モード

**表示件数**: 10/20/30/50件（ボタン式）

**凡例エリア**:
- 記号の説明: ◯見出し語掲載 / △関連語掲載 / -掲載なし
- 注意書き: 「※単語帳を変更したら、「比較実行」を押してください」
- 上部比較実行ボタン（横長画面のみ表示）

**テーブル構造**:
| 単語入力欄 | 単語帳1 | 単語帳2 | 単語帳3 |

- 「単語」ヘッダーの下に「すべてクリア」ボタン
- 下部に「比較実行」ボタン（PC）
- 画面下部固定の「比較実行」ボタン（スマホ）

**URL連携**（大問詳細ページから遷移時）:
```
/words?mode=compare&words=["word1","word2","word3"]
```

---

#### 3.4.3 大学別検索モード

**フィルター項目**:
| フィルター | 入力形式 | 説明 |
|-----------|----------|------|
| 年度 | ドロップダウン×2 | 開始年〜終了年の範囲指定 |
| 大学名 | チェックボックス | 複数選択可、選択件数表示 |
| 学部 | チェックボックス | 選択した大学に連動して候補絞り込み |
| 品詞 | チェックボックス | 動詞/名詞/形容詞/前置詞/接続詞など |
| レベル | チェックボックス | 修練🚀/上級🔬/標準🖋️/基礎📘 |

**検索結果テーブル（レスポンシブ対応）**:

PC（md以上）: 7カラム
| 順位 | 出題回数 | 品詞 | レベル | 単語 | 意味 | ☑ |

スマホ（md未満）: 5カラム
| # | 回数 | 品詞/Lv | 単語/意味 | ☑ |

- 出題回数の多い順にソート
- 50件ごとのページネーション
- レベル別の色分けバッジ（修練:紫、上級:赤、標準:青、基礎:緑）
- 行クリックで単語詳細モーダル表示

**チェックボックス機能**:
- 各行の右端にカスタムチェックボックス
- 未選択時: グレーボーダーの角丸ボタン
- 選択時: 緑背景 + 白✓マーク + シャドウ
- ヘッダーのチェックボックスで現在のページを全選択/全解除
- 選択中の行は薄緑背景

**一括比較機能**:
- 検索結果ヘッダーに「✓ ○件を一括比較」ボタン表示（1件以上選択時）
- クリックで新規タブに単語帳比較モードを開く
- 選択した単語が自動入力され比較実行

**単語詳細モーダル**:
- 単語クリックでモーダル表示
- ヘッダー: 単語名 + 意味 + 品詞バッジ + レベルバッジ + 出題回数
- 本体: 出題大問一覧テーブル（大学名/年度/日程/学部/大問番号/ジャンル+ハッシュタグ）
- 大問クリックで詳細ページへ遷移

---

### 3.5 記事一覧 (`app/articles/page.js`)

#### 概要
ブログ記事の一覧を表示。カテゴリでフィルタリング可能。

#### カテゴリ
- **出題分析**: 大学別・年度別の出題傾向分析
- **書籍レビュー**: 単語帳や参考書のレビュー
- **コラム**: その他の情報発信

#### フィルター機能
- 「すべて」ボタンで全件表示
- カテゴリボタンで絞り込み

#### 記事カード
```
┌─────────────────────────────────────────────────────┐
│ ┌─────────────────────────────────────────────────┐ │
│ │         アイキャッチ画像（16:9）                  │ │
│ └─────────────────────────────────────────────────┘ │
│ [カテゴリ]                              2026-02-05  │
│                                                     │
│ 記事タイトル                                         │
│                                                     │
│ 記事の説明文（description）が表示される...            │
│                                                     │
│ #タグ1 #タグ2 #タグ3                                 │
└─────────────────────────────────────────────────────┘
```

#### 画像表示ロジック
- `image` 列に値があればその画像パスを使用
- 空の場合はカテゴリ別デフォルト画像を表示:
  - 出題分析: `default-analysis.svg`（青系グラデーション）
  - 書籍レビュー: `default-review.svg`（橙系グラデーション）
  - コラム: `default-column.svg`（紫系グラデーション）
- 画像読み込みエラー時は `onError` でデフォルト画像にフォールバック

#### カテゴリ色分け
| カテゴリ | 色 |
|---------|-----|
| 出題分析 | 青 (`bg-blue-100 text-blue-800`) |
| 書籍レビュー | 橙 (`bg-orange-100 text-orange-800`) |
| コラム | 紫 (`bg-purple-100 text-purple-800`) |

---

### 3.6 記事詳細 (`app/articles/[slug]/page.js` + `ArticleDetailClient.js`)

#### 概要
個別の記事本文を表示。Markdownで記述された記事をレンダリング。
サーバーコンポーネント（`page.js`）でOGPメタデータを設定し、クライアントコンポーネント（`ArticleDetailClient.js`）で描画。

#### コンポーネント構成
- **`page.js`（サーバーコンポーネント）**: `generateMetadata` でOGP/Twitter Card設定、`ArticleDetailClient` を呼び出し
- **`ArticleDetailClient.js`（クライアントコンポーネント）**: データ取得・表示ロジック

#### OGP/Twitter Card
- `og:title`: 記事タイトル
- `og:description`: 記事説明文
- `og:image`: アイキャッチ画像（1200×630px）
- `twitter:card`: summary_large_image
- サーバーサイドで `loadArticlesDataServer.js`（`fs` + PapaParse）を使用してCSV読み込み

#### セクション構成

1. **パンくずリスト**
   ```
   🏠 / 記事一覧 / 記事タイトル...
   ```

2. **トップ画像（アイキャッチ）**
   - 16:9のアスペクト比で表示
   - `image` 列が空の場合はカテゴリ別デフォルト画像
   - `onError` でフォールバック

3. **記事ヘッダー**
   - カテゴリバッジ
   - 投稿日
   - タイトル
   - 説明文（description）
   - タグ一覧

4. **記事本文**
   - Markdownレンダリング
   - カスタムスタイル適用（見出し、リスト、テーブル、引用など）
   - `img` タグは `<figure>` + `<figcaption>` でカスタムレンダリング（alt属性をキャプションとして表示）

5. **記事一覧に戻るボタン**

#### Markdownスタイル
- h1, h2: 下線付き見出し
- 強調（`**text**`）: 緑色
- リンク: 緑色、アンダーライン
- 引用: 左ボーダー緑、イタリック
- テーブル: ボーダー付き
- コードブロック: ダーク背景
- 画像: 角丸+影付き、altテキストをキャプション表示

---

## 4. 共通コンポーネント

### 4.1 ヘッダー (`app/components/Header.js`)

#### 概要
全ページ共通のナビゲーションヘッダー。

#### 機能
- ロゴクリックでトップページへ
- PC表示: ナビゲーションリンクを常時表示
- スマホ表示: ハンバーガーメニュー
- 現在のページをハイライト表示

#### ナビゲーション項目
| リンク | パス |
|--------|------|
| トップ | `/` |
| 長文検索 | `/search` |
| 単語検索 | `/words` |
| 記事 | `/articles` |

#### Props
| prop | 型 | 説明 |
|------|-----|------|
| pageTitle | string | ページタイトル（ロゴの横に表示） |
| pageDescription | string | ページの説明文 |

### 4.2 フッター (`app/components/Footer.js`)

#### 概要
全ページ共通のフッター。問い合わせリンクとコピーライトを表示。

#### 表示内容
- 「問い合わせ・データ修正依頼はこちら」リンク（Googleフォームへ）
  - URL: https://forms.gle/KiNp1WfdF5xYDHhC7
  - target="_blank" rel="noopener noreferrer"
  - スタイル: text-emerald-600 hover:underline
- コピーライト「© 2025 SHINQUIRO」

#### デザイン
- bg-white border-t mt-12 py-6
- テキスト中央寄せ

---

## 5. データ構造

### 5.1 CSVファイル一覧

全て `public/data/` に配置

| ファイル名 | 説明 | 読み込み元 |
|-----------|------|-----------|
| mondai.csv | 大問マスタ | loadData.js |
| setsumon.csv | 設問詳細 | loadData.js |
| knowledge.csv | 知識・文法タグ | loadData.js |
| hashtags.csv | テーマタグ | loadData.js |
| universities.csv | 大学マスタ | loadData.js |
| tangocho.csv | 単語帳掲載データ | loadWordData.js |
| keywords.csv | 重要単語マスタ | loadKeywordData.js |
| word_master.csv | 単語マスタ（品詞・意味） | loadWordMasterData.js |
| tangocho_master.csv | 単語帳マスタ（ASIN） | loadTangochoMasterData.js |
| articles.csv | 記事メタ情報 | loadArticlesData.js / loadArticlesDataServer.js |

### 5.2 各CSVの列構造

#### mondai.csv（大問マスタ）
```
大問ID,識別名,試験区分,大学名,年度,日程,方式,学部,大問番号,本文語数,本文レベル,ジャンル,設問数,文章記述,出典,ASIN
```

#### setsumon.csv（設問詳細）
```
大問ID,設問ID,設問名,設問カテゴリ,設問形式
```

#### knowledge.csv（知識・文法タグ）
```
設問ID,知識・文法
```

#### hashtags.csv（テーマタグ）
```
大問ID,ハッシュタグ
```

#### universities.csv（大学マスタ）
```
試験区分,大学名,大学コード
```

#### tangocho.csv（単語帳掲載データ）
```
ID,単語帳名称,単語,掲載区分,単語帳内番号,ページ数
```

#### keywords.csv（重要単語マスタ）
```
大問ID,設問ID,単語,品詞,レベル,意味
```

#### word_master.csv（単語マスタ）
```
原形,出現,品詞,レベル,優先度,意味
```

#### tangocho_master.csv（単語帳マスタ）
```
単語帳名称,ASIN
```

#### articles.csv（記事メタ情報）
```
slug,title,category,date,description,tags,image
```

| 列名 | 説明 | 例 |
|------|------|-----|
| slug | URL用識別子 | target1900-eiken-pre1 |
| title | 記事タイトル | ターゲット1900で英検準1級は戦えるのか？ |
| category | カテゴリ | 出題分析/書籍レビュー/コラム |
| date | 投稿日 | 2026-02-05 |
| description | 説明文 | ターゲット1900だけで英検準1級の語彙を... |
| tags | タグ（パイプ区切り） | ターゲット1900\|英検準1級\|単語帳 |
| image | アイキャッチ画像パス（空欄可） | /images/articles/my-image.jpg |

---

## 6. ディレクトリ構造

```
SHINQUIRO/
├── app/
│   ├── page.js                    # トップページ（ハブ）
│   ├── layout.tsx                 # ルートレイアウト
│   ├── components/
│   │   ├── Header.js              # 共通ヘッダー
│   │   └── Footer.js              # 共通フッター
│   ├── search/
│   │   └── page.js                # 長文検索
│   ├── mondai/[id]/
│   │   └── page.js                # 大問詳細ページ
│   ├── university/[code]/
│   │   └── page.js                # 大学別一覧ページ
│   ├── words/
│   │   └── page.js                # 単語検索・単語帳比較・大学別検索
│   ├── articles/
│   │   ├── page.js                # 記事一覧
│   │   └── [slug]/
│   │       ├── page.js            # 記事詳細（サーバーコンポーネント）
│   │       └── ArticleDetailClient.js # 記事詳細クライアント描画
│   └── about/
│       ├── passage-levels/
│       │   └── page.js            # 本文レベル説明
│       └── question-formats/
│           └── page.js            # 設問形式説明（準備中）
│
├── lib/
│   ├── loadData.js                # メインデータ読み込み
│   ├── loadKeywordData.js         # 重要単語データ読み込み
│   ├── loadWordData.js            # 単語帳データ読み込み
│   ├── loadWordMasterData.js      # 単語マスターデータ読み込み
│   ├── loadTangochoMasterData.js  # 単語帳マスターデータ読み込み
│   ├── loadArticlesData.js        # 記事データ読み込み（クライアント用）
│   └── loadArticlesDataServer.js  # 記事データ読み込み（サーバー用）
│
├── public/
│   ├── data/
│   │   ├── mondai.csv
│   │   ├── setsumon.csv
│   │   ├── knowledge.csv
│   │   ├── hashtags.csv
│   │   ├── universities.csv
│   │   ├── tangocho.csv
│   │   ├── keywords.csv
│   │   ├── word_master.csv
│   │   ├── tangocho_master.csv
│   │   └── articles.csv
│   ├── images/
│   │   └── articles/
│   │       └── defaults/          # デフォルトアイキャッチ画像（SVG）
│   ├── articles/
│   │   └── [slug].md              # 記事本文（Markdown）
│   ├── reviews/
│   │   └── [識別名].md            # 大問ごとの講評
│   └── docs/
│       ├── passage-levels.md      # 本文レベル説明
│       └── question-formats.md    # 設問形式説明
│
├── package.json
└── README.md
```

---

## 7. データ入力ワークフロー

### 7.1 新しい記事を追加する場合

#### Step 1: articles.csv に記事メタ情報を追加
```csv
slug,title,category,date,description,tags,image
new-article-slug,記事タイトル,出題分析,2026-02-10,記事の説明文...,タグ1|タグ2|タグ3,
```
- `image` 列は空欄でOK（カテゴリ別デフォルト画像が使われる）
- カスタム画像を使う場合は `/images/articles/xxx.jpg` のようにパスを指定

**slugの命名規則**:
- 英数字とハイフンのみ
- 小文字で統一
- 短く、内容がわかる名前

**categoryの選択肢**:
- 出題分析
- 書籍レビュー
- コラム

#### Step 2: Markdownファイルを作成
`public/articles/[slug].md` を作成

```markdown
## はじめに

記事の導入文...

## 見出し1

本文...

## まとめ

まとめ文...
```

---

### 7.2 新しいカテゴリを追加する場合

1. `articles.csv` に新しいカテゴリ名で記事を追加
2. `app/articles/page.js` の `getCategoryColor()` 関数に色を追加
3. `app/articles/[slug]/ArticleDetailClient.js` の `getCategoryColor()` 関数にも同様に追加
4. `lib/loadArticlesData.js` の `getArticleImagePath()` にデフォルト画像マッピングを追加
5. `lib/loadArticlesDataServer.js` の `getArticleImagePathServer()` にも同様に追加
6. `public/images/articles/defaults/` にデフォルト画像を配置

---

## 8. 本文レベル基準

| レベル | 基準 | 目安 |
|--------|------|------|
| S | 英検1級上位レベル | 最難関 |
| A | 英検1級下位レベル | 難関 |
| B | 英検準1級上位レベル | やや難 |
| C | 英検準1級下位レベル | 標準 |
| D | 〜英検2級レベル | 基礎 |

---

## 9. 重要単語レベル基準

| レベル | アイコン | 色 | 説明 |
|--------|----------|-----|------|
| 修練 | 🚀 | 紫 | 最難関語彙 |
| 上級 | 🔬 | 赤 | 発展的語彙 |
| 標準 | 🖋️ | 青 | 標準的語彙 |
| 基礎 | 📘 | 緑 | 基礎的語彙 |

---

## 10. 技術的ポイント

### 10.1 データ読み込み
- **キャッシュ機能**: 各loadXXXData.jsでキャッシュ実装
- **PapaParse**: CSVパースに使用（header: true, skipEmptyLines: true）

### 10.2 ルーティング
- `usePathname()` でアクティブなナビゲーション判定
- `use(params)` でNext.js App Routerのパラメータ解決

### 10.3 レスポンシブ対応
```javascript
// PC用ナビゲーション
<nav className="hidden md:flex">...</nav>

// スマホ用ハンバーガーメニュー
<button className="md:hidden">...</button>
```

### 10.4 Markdownレンダリング
- `react-markdown` を使用
- カスタムスタイルは `<style jsx global>` で定義
- `components` prop で `img` タグをカスタムレンダリング（`<figure>` + `<figcaption>`）

### 10.5 サーバー/クライアントコンポーネント分離
- `generateMetadata`（OGP設定）が必要なページはサーバーコンポーネント化
- クライアント側のロジック（データfetch、状態管理、イベントハンドラ）は別ファイルに分離
- サーバー側でCSVを読み込む場合は `fs` + PapaParse を使用（`loadArticlesDataServer.js`）
- パターン: `page.js`（サーバー）→ `XxxClient.js`（クライアント）に `slug` 等をpropsで渡す

---

## 11. 今後の予定

### 機能拡張
- [x] トップページ（ハブ）の作成
- [x] 長文検索を `/search` に移動
- [x] 記事機能の追加
- [x] ヘッダーナビゲーションの改善
- [ ] 設問形式説明ページの作成
- [ ] お気に入り機能
- [ ] 最近見た大問の履歴
- [ ] 複数大問の比較機能

### 公開準備
- [ ] Google Analytics 4 導入
- [ ] Google Search Console 登録
- [ ] プライバシーポリシーページ
- [x] OGP画像設定（記事ページ）
- [ ] OGP画像設定（その他ページ）
- [ ] サイトマップ生成

### 収益化
- [ ] Google AdSense
- [ ] Amazon アフィリエイト
- [ ] Cookie同意バナー

---

## 12. トラブルシューティング

| 問題 | 原因 | 解決策 |
|------|------|--------|
| 記事が404になる | slugの不一致 | articles.csvのslugとMarkdownファイル名を一致させる |
| 記事本文が表示されない | Markdownファイルがない | `public/articles/[slug].md` を作成 |
| ヘッダーリンクが動かない | パスの誤り | `href` の値を確認 |
| カテゴリ色が表示されない | getCategoryColor未定義 | 該当カテゴリの色を追加 |

---

## 付録: クイックリファレンス

### よく使うファイルパス
```
トップページ:     app/page.js
長文検索:         app/search/page.js
大問詳細:         app/mondai/[id]/page.js
大学一覧:         app/university/[code]/page.js
単語検索:         app/words/page.js
記事一覧:         app/articles/page.js
記事詳細(server): app/articles/[slug]/page.js
記事詳細(client): app/articles/[slug]/ArticleDetailClient.js
ヘッダー:         app/components/Header.js
フッター:         app/components/Footer.js
データ読込:       lib/loadData.js
記事データ(client): lib/loadArticlesData.js
記事データ(server): lib/loadArticlesDataServer.js
```

### CSVファイル
```
public/data/mondai.csv           → 大問マスタ
public/data/setsumon.csv         → 設問詳細
public/data/knowledge.csv        → 知識・文法タグ
public/data/hashtags.csv         → テーマタグ
public/data/universities.csv     → 大学マスタ
public/data/tangocho.csv         → 単語帳掲載データ
public/data/keywords.csv         → 重要単語マスタ
public/data/word_master.csv      → 単語マスタ（品詞・意味）
public/data/tangocho_master.csv  → 単語帳マスタ（ASIN）
public/data/articles.csv         → 記事メタ情報
```

### Markdownファイル
```
public/reviews/[識別名].md       → 大問ごとの講評
public/articles/[slug].md        → 記事本文
```

---

## 更新履歴

| 日付 | バージョン | 内容 |
|------|-----------|------|
| 2025年1月 | 2.0 | 初版作成 |
| 2026年1月 | 2.1 | 単語検索に大学別検索モード追加、keywords.csvに品詞・意味列追加、大学別ページのレスポンシブ対応・行クリック対応 |
| 2026年1月 | 2.2 | word_master.csv追加、単語検索モードに品詞・意味表示追加、大学別検索モードのレスポンシブ対応・チェックボックス追加・一括比較機能追加 |
| 2026年1月 | 2.3 | 単語帳比較モードに注意書き・上部比較実行ボタン・すべてクリアボタン追加 |
| 2026年2月 | 2.4 | tangocho_master.csv追加、単語検索モードで単語帳名にAmazonリンク追加 |
| 2026年2月 | **3.0** | **サイト構成の大幅変更**: トップページ（ハブ）新設、長文検索を`/search`に移動、記事機能追加（`/articles`）、ヘッダーナビゲーション改善 |
| 2026年2月 | 3.1 | 共通フッターコンポーネント追加（問い合わせ・データ修正依頼リンク）、全ページにフッター適用 |
| 2026年2月 | **3.2** | **記事画像機能追加**: アイキャッチ画像（カテゴリ別デフォルト画像対応）、記事詳細ページのサーバー/クライアント分離、OGP/Twitter Card設定、Markdown内画像のキャプション対応 |
| 2026年2月 | **3.3** | **重要単語・単語検索の大幅改善**: 複数レベル対応、品詞フィルタ（一覧/チェック両モード）、「出題意味のみチェック」トグル、結果画面に品詞・意味表示、単語帳モーダルに品詞・意味・レベル表示、「データの修正を依頼」リンク追加、単語検索の品詞バッジ統一・横並び化、「出現した大問」意味フィルタ追加、選択色の統一（emerald-600）、word_master優先度ソートのバグ修正 |